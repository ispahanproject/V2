<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CO-PILOT PAD v2</title>

    „ÄÄ<meta name="apple-mobile-web-app-capable" content="yes">
„ÄÄ„ÄÄ„ÄÄ<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
„ÄÄ„ÄÄ„ÄÄ<meta name="apple-mobile-web-app-title" content="CO-PILOT">
    
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="../css/v2_style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="app-grid">
        <aside class="status-panel">
            <a href="index.html" class="nav-back">‚óÄ HOME</a>

            <div class="leg-tabs" id="leg-nav-area"></div>

            <div class="flight-id-area">
                <div class="flt-main" onclick="openNumpad('flt')">
                    <span class="prefix">JL</span><span id="disp-flt">----</span>
                </div>
                <div class="route-main">
                    <span id="disp-dep" class="apt-code" onclick="openKeyboard('dep')">---</span>
                    <span class="arrow">‚úàÔ∏é</span>
                    <span id="disp-arr" class="apt-code" onclick="openKeyboard('arr')">---</span>
                </div>
                
                <div class="time-mode-switch">
                    <button class="tm-btn active" id="tm-dom" onclick="toggleTimeMode('DOM')">DOM (LOC)</button>
                    <button class="tm-btn" id="tm-int" onclick="toggleTimeMode('INT')">INT (UTC)</button>
                </div>
            </div>

            <div class="time-grid-huge">
                <div class="t-cell" onclick="openNumpad('std')">
                    <span class="t-label">STD</span>
                    <span class="t-val" id="disp-std">--:--</span>
                </div>
                
                <div class="t-cell" onclick="openNumpad('sta')">
                    <span class="t-label">STA</span>
                    <span class="t-val" id="disp-sta">--:--</span>
                </div>
                
                <div class="t-cell" onclick="openNumpad('timeEnroute')">
                    <span class="t-label">EST FLT TIME</span>
                    <span class="t-val val-green" id="disp-flt-time">--:--</span>
                </div>
                
                <div class="t-cell" onclick="openNumpad('taxi')">
                    <span class="t-label">TAXI(AFT LDG)</span>
                    <span class="t-val val-green" id="disp-taxi">--</span>
                </div>
            </div>

           <div class="metrics-row">
                <div class="m-box warning">
                    <span class="m-label">TTOT</span>
                    <span class="m-val" id="disp-ttot">--:--</span>
                </div>
                <div class="m-box info">
                    <span class="m-label">INTERVAL</span>
                    <span class="m-val" id="disp-interval">--+--</span>
                </div>
            </div>

            <div class="bottom-status">
                <div class="status-row pax-group">
                    <div class="pax-box main" onclick="openNumpad('paxTotal')">
                        <span class="pax-label">PAX TOTAL</span>
                        <span class="pax-val" id="disp-pax-total">---</span>
                    </div>
                    <div class="pax-box sub" onclick="openNumpad('paxInf')">
                        <span class="pax-label">INFANT</span>
                        <span class="pax-val small" id="disp-pax-inf">--</span>
                    </div>
                </div>

                <button class="sp-btn full-row" id="btn-sp-pax" onclick="openModal('sp')">
                    <div class="sp-content-left">
                        <span class="sp-icon">‚ôø</span>
                        <span class="sp-label">SPECIAL PAX</span>
                    </div>
                    <span class="badge" id="badge-sp">0</span>
                </button>

                <button class="sp-btn full-row" id="btn-sp-load" onclick="openModal('load')">
                    <div class="sp-content-left">
                        <span class="sp-icon">üì¶</span>
                        <span class="sp-label">SPECIAL LOAD</span>
                    </div>
                    <div class="dot" id="dot-load"></div>
                </button>
            </div>

            <button class="btn-close" onclick="openCloseLegModal()">CLOSE LEG</button>
        </aside>

        <main class="main-panel">
            
            <section class="workspace-area">
                <div class="tabs-row">
                    <button class="sys-tab active" onclick="switchTab('checklist')" id="tab-btn-checklist">
                        <span class="tab-icon">‚úì</span> CHECKLIST
                    </button>
                    <button class="sys-tab" onclick="switchTab('turb')" id="tab-btn-turb">
                        <span class="tab-icon">‚ö°</span> TURB LOG
                    </button>
                    <button class="sys-tab" onclick="switchTab('wx')" id="tab-btn-wx">
                        <span class="tab-icon">‚òÅÔ∏è</span> WX
                    </button>
                    <button class="sys-tab" onclick="switchTab('ref')" id="tab-btn-ref">
                        <span class="tab-icon">üìö</span> REF
                    </button>
                </div>

                <div class="tab-content active" id="tab-content-checklist">
                    <div id="checklist-area" class="checklist-container"></div>
                    <div id="checklist-complete-msg">BLOCK OUT READY</div>
                </div>

                <div class="tab-content" id="tab-content-turb">
                    <div class="turb-layout">
                        <div class="turb-input-zone">
                            <div class="turb-group group-fl">
                                <div class="tg-label">FL (FROM - TO)</div>
                                <div class="fl-dual-container">
                                    <div class="fl-scroll-box" id="turb-fl-from"></div>
                                    <div class="fl-scroll-box" id="turb-fl-to"></div>
                                </div>
                            </div>
                            <div class="turb-group group-cause">
                                <div class="tg-label">CAUSE</div>
                                <div class="cause-grid">
                                    <button class="c-btn" onclick="setTurbCause('CLR')">CLR</button>
                                    <button class="c-btn" onclick="setTurbCause('ITC')">ITC</button>
                                    <button class="c-btn" onclick="setTurbCause('INC')">INC</button>
                                    <button class="c-btn" onclick="setTurbCause('BSE')">BSE</button>
                                    <button class="c-btn" onclick="setTurbCause('JBS')">JBS</button>
                                    <button class="c-btn" onclick="setTurbCause('BTW')">BTW</button>
                                    <button class="c-btn" onclick="setTurbCause('JTP')">JTP</button>
                                    <button class="c-btn" onclick="setTurbCause('TOP')">TOP</button>
                                    <button class="c-btn" onclick="setTurbCause('OTP')">OTP</button>
                                </div>
                            </div>
                            <div class="turb-group group-freq">
                                <div class="tg-label">DURATION</div>
                                <div class="int-stack">
                                    <button class="i-btn freq" id="btn-intm" onclick="setTurbFreq('INTM')">INTM</button>
                                    <button class="i-btn freq" id="btn-ocnl" onclick="setTurbFreq('OCNL')">OCNL</button>
                                    <button class="i-btn freq" id="btn-cont" onclick="setTurbFreq('CONT')">CONT</button>
                                </div>
                            </div>
                            <div class="turb-group group-int">
                                <div class="tg-label">INTENSITY</div>
                                <div class="int-stack">
                                    <button class="i-btn t1" onclick="addTurbLog('TB1')">TB1</button>
                                    <button class="i-btn t2" onclick="addTurbLog('TB2')">TB2</button>
                                    <button class="i-btn t3" onclick="addTurbLog('TB3')">TB3</button>
                                    <button class="i-btn t4" onclick="addTurbLog('TB4')">TB4</button>
                                    <button class="i-btn t6" onclick="addTurbLog('TB6')">TB6</button>
                                </div>
                            </div>
                        </div>
                        <div class="turb-log-header">
                            <span style="flex:1.2">FL</span>
                            <span style="flex:1">CAUSE</span>
                            <span style="flex:0.8">DUR</span>
                            <span style="flex:0.8">INT</span>
                            <span style="flex:0.8; text-align:right;">TIME</span>
                        </div>
                        <div class="turb-log-list" id="turb-log-list"></div>
                    </div>
                </div>

                <div class="tab-content" id="tab-content-wx">
                    <div class="wx-display-container">
                        <div class="wx-ctrl-row">
                            <div class="wx-station-display">
                                <span class="wx-label-mini">ICAO</span>
                                <span class="wx-station-code" id="wx-target-code" onclick="inputWxStation()">----</span>
                            </div>
                            <div class="wx-tabs-mini">
                                <button class="wx-mini-btn active" id="wx-btn-dep" onclick="switchWxView('dep')">DEP</button>
                                <button class="wx-mini-btn" id="wx-btn-arr" onclick="switchWxView('arr')">ARR</button>
                                <button class="wx-mini-btn" id="wx-btn-others" onclick="switchWxView('others')">OTHERS</button>
                            </div>
                            <button class="wx-refresh-btn" onclick="refreshWx()">üîÑ REFRESH</button>
                        </div>
                        
                        <div class="wx-data-box vmc" id="wx-box-metar">
                            <div class="wx-box-label">METAR</div>
                            <div class="wx-text-body" id="wx-content-metar">--</div>
                        </div>
                        
                        <div class="wx-data-box" id="wx-box-taf">
                            <div class="wx-box-label">TAF</div>
                            <div class="wx-text-body" id="wx-content-taf">--</div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-content-ref">
                    <div class="ref-grid-tab">
                        <div class="ref-card-btn" onclick="openModal('wb')">
                             <span class="ref-icon-large">‚öñÔ∏è</span>
                             <span class="ref-title">WEIGHT & BALANCE</span>
                        </div>

                        <div class="ref-card-btn" onclick="openModal('scenario')">
                              <span class="ref-icon-large">‚è±Ô∏è</span>
                              <span class="ref-title">SCENARIO„ÄÄCOMPARISON</span>
                        </div>

                        <div class="ref-card-btn coming-soon">
            <span class="ref-icon-large">‚ùÑÔ∏è</span>
            <span class="ref-title">COLD WX<br>OPS</span>
        </div>

                        <div class="ref-card-btn" onclick="openModal('hold')">
                            <span class="ref-icon-large">‚úàÔ∏è</span>
                            <span class="ref-title">HOLDING</span>
                        </div>
                        
                        <div class="ref-card-btn" onclick="openModal('converter')">
                            <span class="ref-icon-large">üì±</span>
                            <span class="ref-title">IAS/MACH CONVERTER</span>
                        </div>

                        <div class="ref-card-btn coming-soon">
            <span class="ref-icon-large">üîß</span>
            <span class="ref-title">MEL / CDL</span>
        </div>
                        <div class="ref-card-btn coming-soon">
            <span class="ref-icon-large">üìû</span>
            <span class="ref-title">STATION<br>CONTACT</span>
        </div>

                        <div class="ref-card-btn" onclick="openModal('log')">
                             <span class="ref-icon-large">üìì</span>
                             <span class="ref-title">PERSONAL<br>LOG</span>
                        </div>
                    </div>
                </div>

                <div id="leg-comp-overlay" class="leg-comp-overlay">
                  <div class="comp-icon">‚úì</div>
                  <div class="comp-title">LEG COMPLETED</div>
                  <div class="comp-sub">DATA LOCKED</div>
                  <button class="btn-reopen" onclick="reOpenLeg()">&#8634; RE-OPEN LEG</button>
</div>
            </section>


           <section class="launcher-area">
                <div class="launch-btn" onclick="openModal('calc-wind')">
                    <div class="l-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2" />
                        </svg>
                    </div>
                    <div class="l-label">WIND CALC</div>
                </div>

                <div class="launch-btn" onclick="openModal('perf')">
                    <div class="l-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 22h20" />
                            <path d="M5.8 17L3 12.5l5.5-2.5L12 3l3.5 6 7 2-1.5 3.5" />
                        </svg>
                    </div>
                    <div class="l-label">LDG PERF</div>
                </div>

                <div class="launch-btn" onclick="openModal('tfc')">
                    <div class="l-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <circle cx="12" cy="12" r="4" />
                            <path d="M12 12L20.5 7.5" />
                        </svg>
                    </div>
                    <div class="l-label">TFC</div>
                </div>

                <div class="launch-btn" onclick="openModal('cross')">
                    <div class="l-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="12" x2="21" y2="12" stroke-dasharray="4 4" />
                            <path d="M7 20V4l6 6" />
                            <path d="M17 20V4l-6 6" transform="translate(4,0)" /> 
                        </svg>
                    </div>
                    <div class="l-label" id="cross-label">CROSS OVER</div>
                    <div class="l-val-dynamic" id="cross-val" style="display:none;">FL --</div>
                </div>
            </section>
        </main>
    </div>

    <div id="modal-numpad" class="modal-overlay">
        <div class="numpad-card">
            <div class="np-header"><span id="np-label">VALUE</span><span id="np-val"></span></div>
            <div class="np-grid">
                <button onclick="npInput('7')">7</button><button onclick="npInput('8')">8</button><button onclick="npInput('9')">9</button>
                <button onclick="npInput('4')">4</button><button onclick="npInput('5')">5</button><button onclick="npInput('6')">6</button>
                <button onclick="npInput('1')">1</button><button onclick="npInput('2')">2</button><button onclick="npInput('3')">3</button>
                <button onclick="npInput('0')" class="zero">0</button><button onclick="npBack()" class="del">‚å´</button>
            </div>
            <div class="np-footer"><button class="np-cancel" onclick="closeModal('numpad')">CANCEL</button><button class="np-ok" onclick="npConfirm()">ENTER</button></div>
        </div>
    </div>

    <div id="modal-sp" class="modal-overlay" onclick="closeModal('sp')">
        <div class="sp-iso-modal-content" onclick="event.stopPropagation()">
            <div class="sp-iso-modal-header">
                SPECIAL PASSENGER HANDLING & LIMITS
                <button class="sp-iso-header-clear" onclick="clearSpData()">CLEAR</button>
            </div>
            
            <div class="sp-iso-body">
                <div class="sp-iso-col-left">
                    <span class="label-mini" style="color: var(--primary) !important;">QUANTITY</span>
                    <div class="sp-iso-grid" id="sp-iso-grid-area"></div>
                    <input type="text" id="sp-iso-memo" class="sp-iso-memo-input" 
                           placeholder="REMARKS (e.g. SEAT 5A WCHC)" oninput="updateSpMemo(this.value)">
                </div>

                <div class="sp-iso-col-right">
                    <div class="sp-iso-ref-header">
                        <span class="pos-code">CODE</span>
                        <span class="pos-solo">ÂçòÁã¨Êê≠‰πó</span>
                        <span class="pos-note">ÂÇôËÄÉ</span>
                    </div>
                    <div id="sp-iso-ref-list" class="sp-iso-ref-list-container"></div>
                    
                    <div class="sp-iso-ref-footer">
                        <span class="sp-iso-limit-title">B737-800 HANDLING NOTES & LIMITS</span>
                        ‚Ä¢ WCHC/S/R + STCR ÂêàË®àÊúÄÂ§ß 8Âêç / STCR ÊúÄÂ§ß 1Âêç<br>
                        ‚Ä¢ WCHC ÂçòÁã¨Ôºö150Â∏≠‰ª•‰∏ãÊßãÊàê Max 1 / 151Â∏≠‰ª•‰∏äÊßãÊàê Max 2
                    </div>
                </div>
            </div>

            <div class="sp-iso-btn-group">
                <button class="sp-iso-btn-confirm" onclick="closeModal('sp'); render();">CONFIRM & CLOSE</button>
            </div>
        </div>
    </div> 
    
    <div id="modal-load" class="modal-overlay" onclick="closeModal('load')">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="m-head" style="display:flex; justify-content:space-between; align-items:center;">
            <span>SPECIAL LOAD / NOTOC</span>
            <button class="header-clear-btn" onclick="clearLoadData()">CLEAR</button>
        </div>
        <div style="overflow-y:auto; padding-right:5px; flex:1;">
            <div class="sec-header" style="margin-top:0">QUANTITY ITEMS</div>

            <div id="row-dry" class="detail-row">
                <div class="row-left">
                    <div class="row-label-group"><span class="row-label">DRY ICE</span><span class="row-sub">„Éâ„É©„Ç§„Ç¢„Ç§„Çπ</span></div>
                    <div class="toggle-group">
                        <button class="toggle-btn active" onclick="setLoadDryMode('DOM')" id="btn-dry-dom">DOM</button>
                        <button class="toggle-btn" onclick="setLoadDryMode('INT')" id="btn-dry-int">INT</button>
                    </div>
                </div>
                <div class="input-group-styled"><input type="number" id="in-dry" class="clean-input" placeholder="0" oninput="validateLoad()"><span class="fixed-unit">KG</span></div>
            </div>

            <div id="row-mag" class="detail-row">
                <div class="row-left">
                    <div class="row-label-group"><span class="row-label">MAGNET</span><span class="row-sub">Á£ÅÊÄßÁâ©Ë≥™</span></div>
                    <div class="pos-group" id="grp-mag-pos">
                        <button class="pos-btn" onclick="toggleLoadPos(this)">F1</button><button class="pos-btn" onclick="toggleLoadPos(this)">F2</button><button class="pos-btn" onclick="toggleLoadPos(this)">R1</button><button class="pos-btn" onclick="toggleLoadPos(this)">R2</button>
                    </div>
                </div>
                <div class="input-group-styled"><input type="number" id="in-mag" class="clean-input" placeholder="0" oninput="validateLoad()"><span class="fixed-unit">KG</span></div>
            </div>

            <div id="row-radio" class="detail-row">
                <div class="row-left">
                    <div class="row-label-group"><span class="row-label">RADIO</span><span class="row-sub">ÊîæÂ∞ÑÊÄßÁâ©Ë≥™</span></div>
                    <div class="pos-group" id="grp-radio-pos">
                        <button class="pos-btn" onclick="toggleLoadPos(this)">F1</button><button class="pos-btn" onclick="toggleLoadPos(this)">F2</button><button class="pos-btn" onclick="toggleLoadPos(this)">R1</button><button class="pos-btn" onclick="toggleLoadPos(this)">R2</button>
                    </div>
                </div>
                <div class="input-group-styled"><input type="number" id="in-radio-ti" step="0.1" class="clean-input" placeholder="0" oninput="validateLoad()"><span class="fixed-unit">TI</span></div>
            </div>

            <div id="row-beads" class="detail-row" style="flex-wrap: wrap;">
                <div class="row-label-group"><span class="row-label">UN2211</span><span class="row-sub">Áô∫Ê≥°„Éì„Éº„Ç∫</span></div>
                <div style="flex:1; display:flex; gap:6px; justify-content: flex-end;">
                    <div style="display:flex; flex-direction:column; gap:1px;"><span style="font-size:0.5rem; color:#94a3b8; font-weight:700; padding-left:2px;">FWD</span><div class="input-group-styled" style="width:80px;"><input type="number" id="in-beads-fwd" class="clean-input" placeholder="0" oninput="validateLoad()"><span class="fixed-unit">KG</span></div></div>
                    <div style="display:flex; flex-direction:column; gap:1px;"><span style="font-size:0.5rem; color:#94a3b8; font-weight:700; padding-left:2px;">AFT</span><div class="input-group-styled" style="width:80px;"><input type="number" id="in-beads-aft" class="clean-input" placeholder="0" oninput="validateLoad()"><span class="fixed-unit">KG</span></div></div>
                </div>
            </div>

            <div class="sec-header">IMP DANGEROUS GOODS</div>
            <div class="list-grid" id="load-list-imp">
                <div class="list-btn" onclick="toggleLoadList(this, 'RFL')"><div class="code-box">RFL</div><div class="text-box"><span class="item-name">Flam Liquid</span><span class="item-desc">ÂºïÁÅ´ÊÄßÊ∂≤‰Ωì</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RFS')"><div class="code-box">RFS</div><div class="text-box"><span class="item-name">Flam Solid</span><span class="item-desc">ÂèØÁáÉÊÄßÂõ∫‰Ωì</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RSC')"><div class="code-box">RSC</div><div class="text-box"><span class="item-name">Spont Comb</span><span class="item-desc">Ëá™ÁÑ∂Áô∫ÁÅ´ÊÄß</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RFW')"><div class="code-box">RFW</div><div class="text-box"><span class="item-name">Wet Flam</span><span class="item-desc">Ê∞¥ÂèçÂøúÂèØÁáÉ</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RFG')"><div class="code-box">RFG</div><div class="text-box"><span class="item-name">Flam Gas</span><span class="item-desc">ÂºïÁÅ´ÊÄß„Ç¨„Çπ</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RCM')"><div class="code-box">RCM</div><div class="text-box"><span class="item-name">Corrosive</span><span class="item-desc">ËÖêÈ£üÊÄßÁâ©Ë≥™</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RPB')"><div class="code-box">RPB</div><div class="text-box"><span class="item-name">Toxic</span><span class="item-desc">ÊØíÁâ©</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RIS')"><div class="code-box">RIS</div><div class="text-box"><span class="item-name">Infectious</span><span class="item-desc">ÊÑüÊüìÊÄßÁâ©Ë≥™</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'ELI')"><div class="code-box">ELI</div><div class="text-box"><span class="item-name">Lithium Ion</span><span class="item-desc">„É™„ÉÅ„Ç¶„É†</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'RMD')"><div class="code-box">RMD</div><div class="text-box"><span class="item-name">Misc</span><span class="item-desc">„Åù„ÅÆ‰ªñ</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'CAO')"><div class="code-box">CAO</div><div class="text-box"><span class="item-name">Cargo Only</span><span class="item-desc">Ë≤®Áâ©Ê©ü„ÅÆ„Åø</span></div></div>
            </div>

            <div class="sec-header">GENERAL SPECIAL LOAD</div>
            <div class="list-grid" id="load-list-gen">
                <div class="list-btn" onclick="toggleLoadList(this, 'AVI')"><div class="code-box">AVI</div><div class="text-box"><span class="item-name">Live Animal</span><span class="item-desc">ÁîüÂãïÁâ©</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'HUM')"><div class="code-box">HUM</div><div class="text-box"><span class="item-name">Remains</span><span class="item-desc">ÈÅ∫‰Ωì</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'VAL')"><div class="code-box">VAL</div><div class="text-box"><span class="item-name">Valuable</span><span class="item-desc">Ë≤¥ÈáçÂìÅ</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'SPWP')"><div class="code-box">SPWP</div><div class="text-box"><span class="item-name">Weapons</span><span class="item-desc">ÈäÉÁ†≤ÂàÄÂâ£È°û</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'PRG')"><div class="code-box">PRG</div><div class="text-box"><span class="item-name">Perishable</span><span class="item-desc">ÁîüÈÆÆÁâ©</span></div></div>
                <div class="list-btn" onclick="toggleLoadList(this, 'EAT')"><div class="code-box">EAT</div><div class="text-box"><span class="item-name">Foodstuffs</span><span class="item-desc">È£üÊñôÂìÅ</span></div></div>
            </div>

        </div>
        <button class="m-close" onclick="closeModal('load')">CONFIRM & CLOSE</button>
    </div>
</div>

    <div id="modal-tfc" class="modal-overlay" onclick="closeModal('tfc')">
        <div id="tfc-iso-wrapper" onclick="event.stopPropagation()">
            <div id="tfc-iso-header">
                <div>
                    <div id="tfc-iso-title">TRAFFIC INFO</div>
                    <div id="tfc-iso-subtitle">TARGET: <span id="tfc-target-disp">---</span></div>
                </div>
                <button onclick="closeModal('tfc')" class="tfc-close-btn">CLOSE</button>
            </div>

            <div id="tfc-iso-list-area">
                <div style="text-align:center; padding:20px; color:#64748b;">NO TRAFFIC DATA</div>
            </div>
            
            <div id="tfc-iso-footer">
                <button class="tfc-iso-btn" onclick="refreshTfc()">REFRESH</button>
            </div>
        </div>
    </div>

    <div id="modal-wx" class="modal-overlay" onclick="closeModal('wx')">
        <div class="modal-card wide" onclick="event.stopPropagation()">
            <div class="m-head">WX REPORT</div>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <button class="tab-btn small active" onclick="switchWx('dep')">DEP</button>
                <button class="tab-btn small" onclick="switchWx('arr')">ARR</button>
            </div>
            <div id="wx-content" class="wx-box">NO DATA</div>
            <button class="m-close" onclick="closeModal('wx')">CLOSE</button>
        </div>
    </div>

    <div id="modal-ref" class="modal-overlay" onclick="closeModal('ref')">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="m-head">REFERENCE</div>
            <div class="ref-grid">
                <div>‚õΩ FUEL</div><div>üå™Ô∏è WIND</div><div>‚ö†Ô∏è MEL</div><div>‚ùÑÔ∏è COLD</div>
            </div>
            <button class="m-close" onclick="closeModal('ref')">CLOSE</button>
        </div>
    </div>

    <div id="modal-cross" class="modal-overlay" onclick="closeModal('cross')">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="m-head">CROSSOVER ALTITUDE</div>
            
            <div class="co-input-area">
                <div class="co-input-group">
                    <span class="co-label">DES MACH</span>
                    <div class="co-stepper">
                        <button class="co-step-btn" onclick="adjMach(-0.01)">-</button>
                        <input type="number" id="in-mach" class="co-step-val" value="0.76" step="0.01" readonly style="color:var(--cyan)">
                        <button class="co-step-btn" onclick="adjMach(0.01)">+</button>
                    </div>
                </div>
                <div class="co-input-group">
                    <span class="co-label">DES IAS</span>
                    <div class="co-stepper">
                        <button class="co-step-btn" onclick="adjIas(-10)">-</button>
                        <input type="number" id="in-ias" class="co-step-val" value="280" step="10" readonly style="color:var(--green)">
                        <button class="co-step-btn" onclick="adjIas(10)">+</button>
                    </div>
                </div>
            </div>

            <div class="co-scale-container">
                <span class="co-scale-label mach-zone">MACH DESCENT</span>
                <div class="co-scale-line"></div>
                <div id="visual-fl" class="crossover-marker">--</div>
                <span class="co-scale-label ias-zone">IAS DESCENT</span>
            </div>

            <div class="co-result-box">
                <span style="font-size:0.7rem; color:var(--muted); font-weight:700; letter-spacing:0.1em; display:block; margin-bottom:5px;">TRANSITION LEVEL</span>
                <div class="co-res-display">
                    <span class="co-res-prefix">FL</span>
                    <span id="res-fl" class="co-res-val">--</span>
                </div>
            </div>

            <button class="m-close" onclick="closeModal('cross')">CLOSE</button>
        </div>
    </div>

   <div id="modal-calc-wind" class="modal-overlay" onclick="closeModal('calc-wind')">
    <div class="wind-v5-card" onclick="event.stopPropagation()">
        
        <div class="wind-v5-left">
            <div class="modal-header">
                <div class="modal-title" style="color:#3b82f6;">WIND CALCULATOR</div>
            </div>

            <div class="wind-v5-visual">
                <canvas id="wind-canvas" width="120" height="120"></canvas>
            </div>

            <div class="wind-v5-section">
                <div class="wind-v5-sec-header"><span>üõ´</span>RUNWAY CONFIG</div>
                <div class="wind-v5-row">
                    <div class="wind-v5-col" style="flex:1.2;">
                        <div class="card-head"><span class="wind-v5-label">SELECT RWY</span></div>
                        <select id="calc-rwy-sel" class="wind-v5-input" onchange="updateHdgFromSel()"></select>
                    </div>
                    <div class="wind-v5-col" style="flex:1.8;">
                        <div class="card-head"><span class="wind-v5-label">MAG HDG</span></div>
                        <div class="wind-v5-stepper">
                            <button class="wind-v5-step-btn" onclick="stepHdg(-1)">-1</button>
                            <input type="text" inputmode="numeric" id="calc-hdg" class="wind-v5-input" placeholder="---" oninput="runCalc()" onblur="formatHdg()" maxlength="3">
                            <button class="wind-v5-step-btn" onclick="stepHdg(1)">+1</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="wind-v5-section">
                <div class="wind-v5-sec-header"><span>üí®</span>WIND DATA</div>
                <div class="wind-v5-row">
                    <div class="wind-v5-col" style="flex:1.8;">
                        <div class="card-head"><span class="wind-v5-label">DIRECTION (¬∞)</span></div>
                        <div class="wind-v5-stepper">
                            <button class="wind-v5-step-btn" onclick="stepDir(-10)">-10</button>
                            <input type="text" inputmode="numeric" id="calc-wd" class="wind-v5-input" placeholder="deg" oninput="runCalc()" onblur="formatDir()" maxlength="3">
                            <button class="wind-v5-step-btn" onclick="stepDir(10)">+10</button>
                        </div>
                    </div>
                    <div class="wind-v5-col" style="flex:1.2;">
                        <div class="card-head">
                            <span class="wind-v5-label">SPEED</span>
                            <div class="wind-v5-switch">
                                <div id="u-kt" class="wind-v5-unit-btn active" onclick="setUnit('kt')">KT</div>
                                <div id="u-m" class="wind-v5-unit-btn" onclick="setUnit('m')">m/s</div>
                            </div>
                        </div>
                        <input type="number" id="calc-ws" class="wind-v5-input" placeholder="kt" oninput="runCalc()">
                    </div>
                </div>
            </div>

            <div class="wind-v5-res-grid">
                <div class="wind-v5-res-card">
                    <span class="wind-v5-label">HEAD / TAIL</span>
                    <div><span id="res-hw" class="wind-v5-res-val">--</span><span style="color:#94a3b8; font-size:0.8rem; margin-left:3px;">kt</span></div>
                </div>
                <div class="wind-v5-res-card">
                    <span class="wind-v5-label">CROSS WIND</span>
                    <div><span id="res-xw" class="wind-v5-res-val">--</span><span style="color:#94a3b8; font-size:0.8rem; margin-left:3px;">kt</span></div>
                </div>
            </div>
            <div id="status-display" class="wind-v5-status">--</div>

            <div class="wind-v5-section">
                <div class="wind-v5-sec-header"><span>‚ö†Ô∏è</span>LIMIT CONFIG (KT)</div>
                <div class="wind-v5-limit-grid">
                    <div class="wind-v5-limit-box"><span class="wind-v5-label">HEAD</span><input type="number" id="lim-hw" class="wind-v5-limit-inp" value="25" oninput="saveLimit('hw', this.value)"></div>
                    <div class="wind-v5-limit-box"><span class="wind-v5-label">TAIL</span><input type="number" id="lim-tw" class="wind-v5-limit-inp" value="10" oninput="saveLimit('tw', this.value)"></div>
                    <div class="wind-v5-limit-box"><span class="wind-v5-label">CROSS</span><input type="number" id="lim-xw" class="wind-v5-limit-inp" value="30" oninput="saveLimit('xw', this.value)"></div>
                </div>
            </div>
        </div>

        <div class="wind-v5-right">
            <div class="wind-v5-chart-top">
                <span class="wind-v5-chart-title">LIMIT ANALYSIS (360¬∞)</span>
                <div class="wind-v5-row-head"><div>WIND</div><div>XW-MAX</div><div>HW/TW</div><div>LIMIT</div></div>
            </div>
            <div id="chart-rows" class="wind-v5-chart-scroll"></div>
        </div>
    </div>
</div>
    <div id="modal-perf" class="modal-overlay" onclick="closeModal('perf')">
        <div id="perf-iso-wrapper" onclick="event.stopPropagation()">
            
            <div id="perf-iso-main-cols">
                <div id="perf-iso-col-input">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span class="perf-iso-section-label">INPUT PARAMETERS</span>
                        <span id="perf-apt-name-disp" style="font-size:0.7rem; color:#94a3b8; font-weight:900;"></span>
                    </div>
                    
                    <div style="margin-bottom:10px;">
                        <span class="perf-iso-sub-label">RUNWAY <span id="perf-rwy-data-disp" style="color:#94a3b8; font-weight:400; margin-left:5px;"></span></span>
                        <div id="perf-rwy-btn-container" class="perf-iso-btn-group"><span style="color:#94a3b8; font-size:0.8rem;">Select Airport...</span></div>
                    </div>

                    <div style="margin-bottom:10px;">
                        <span class="perf-iso-sub-label">RWY CONDITION</span>
                        <div class="perf-iso-btn-group">
                            <button class="perf-iso-select-btn perf-iso-cc-btn active" data-val="6" onclick="perfSelectCC(6)">6</button>
                            <button class="perf-iso-select-btn perf-iso-cc-btn" data-val="5" onclick="perfSelectCC(5)">5</button>
                            <button class="perf-iso-select-btn perf-iso-cc-btn" data-val="4" onclick="perfSelectCC(4)">4</button>
                            <button class="perf-iso-select-btn perf-iso-cc-btn" data-val="3" onclick="perfSelectCC(3)">3</button>
                            <button class="perf-iso-select-btn perf-iso-cc-btn" data-val="2" onclick="perfSelectCC(2)">2</button>
                            <button class="perf-iso-select-btn perf-iso-cc-btn" data-val="1" onclick="perfSelectCC(1)">1</button>
                        </div>
                    </div>

                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div style="flex:0.8">
                            <span class="perf-iso-sub-label">FLAP</span>
                            <div class="perf-iso-btn-group">
                                <button class="perf-iso-select-btn active" onclick="perfSelectFlap(this, 30)">30</button>
                                <button class="perf-iso-select-btn" onclick="perfSelectFlap(this, 40)">40</button>
                            </div>
                        </div>
                        <div style="flex:1">
                            <span class="perf-iso-sub-label">ADD SPD</span>
                            <div class="perf-iso-stepper-group">
                                <button class="perf-iso-step-btn" onclick="perfAdjAdd(-1)">‚àí</button>
                                <input type="text" id="perf-add-disp" class="perf-iso-step-input" style="color:#06b6d4;" value="+5" readonly>
                                <button class="perf-iso-step-btn" onclick="perfAdjAdd(1)">+</button>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div style="flex:1">
                            <span class="perf-iso-sub-label">WIND COMP</span>
                            <div class="perf-iso-stepper-group">
                                <button class="perf-iso-step-btn" onclick="perfAdjWind(-5)">T</button>
                                <input type="text" id="perf-wind-disp" class="perf-iso-step-input" style="color:white;" value="0" readonly>
                                <button class="perf-iso-step-btn" onclick="perfAdjWind(5)">H</button>
                            </div>
                        </div>
                        <div style="flex:0.8">
                            <span class="perf-iso-sub-label">REVERSER</span>
                            <div class="perf-iso-btn-group">
                                <button class="perf-iso-select-btn active" onclick="perfSelectRev(this, false)">NO</button>
                                <button class="perf-iso-select-btn" onclick="perfSelectRev(this, true)">REV</button>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div style="flex:1">
                            <span class="perf-iso-sub-label">LDW (1000LBS)</span>
                            <div class="perf-iso-stepper-group">
                                <button class="perf-iso-step-btn" onclick="perfAdjLdw(-1.0)">‚àí</button>
                                <input type="number" id="perf-in-ldw" class="perf-iso-step-input" style="color:white;" value="---.-" onchange="perfCalc()">
                                <button class="perf-iso-step-btn" onclick="perfAdjLdw(1.0)">+</button>
                            </div>
                        </div>
                        <div style="flex:1">
                            <span class="perf-iso-sub-label">AUTOBRAKE</span>
                            <div class="perf-iso-btn-group">
                                <button class="perf-iso-select-btn" onclick="perfSelectBrake(this, 2)">2</button>
                                <button class="perf-iso-select-btn active" onclick="perfSelectBrake(this, 3)">3</button>
                                <button class="perf-iso-select-btn" onclick="perfSelectBrake(this, 4)">MAX</button>
                            </div>
                        </div>
                    </div>

                    <div class="perf-iso-result-container">
                        <div class="perf-iso-res-box">
                            <span class="perf-iso-res-label">VAPP</span>
                            <span class="perf-iso-res-value" id="perf-out-vapp">147</span>
                        </div>
                        <div class="perf-iso-res-box">
                            <span class="perf-iso-res-label">REQ DIST (FACTORED)</span>
                            <div>
                                <span class="perf-iso-res-value" id="perf-out-dist">--</span>
                                <span class="perf-iso-res-sub">ft</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="perf-iso-col-ref">
                    <div class="perf-iso-ref-title">X-WIND LIMIT (KT)</div>
                    <div class="perf-iso-ref-row active" id="perf-row-6" data-cc="6"><span class="perf-iso-ref-cc">CC 6</span><span class="perf-iso-ref-val">33 KT</span></div>
                    <div class="perf-iso-ref-row" id="perf-row-5" data-cc="5"><span class="perf-iso-ref-cc">CC 5</span><span class="perf-iso-ref-val">25 KT</span></div>
                    <div class="perf-iso-ref-row" id="perf-row-4" data-cc="4"><span class="perf-iso-ref-cc">CC 4</span><span class="perf-iso-ref-val">20 KT</span></div>
                    <div class="perf-iso-ref-row" id="perf-row-3" data-cc="3"><span class="perf-iso-ref-cc">CC 3</span><span class="perf-iso-ref-val">20 KT</span></div>
                    <div class="perf-iso-ref-row" id="perf-row-2" data-cc="2"><span class="perf-iso-ref-cc">CC 2</span><span class="perf-iso-ref-val">15 KT</span></div>
                    <div class="perf-iso-ref-row" id="perf-row-1" data-cc="1"><span class="perf-iso-ref-cc">CC 1</span><span class="perf-iso-ref-val">10 KT</span></div>
                    
                    <div style="background:rgba(0,0,0,0.3); padding:8px; border-radius:8px; margin-top:10px; text-align:center;">
                        <span class="perf-iso-xw-label">CURRENT X-WIND</span>
                        <div id="perf-out-xwind" class="perf-iso-xw-val">--</div>
                    </div>
                    
                    <button onclick="closeModal('perf')" style="margin-top:auto; background:rgba(255,255,255,0.1); border:none; color:#94a3b8; padding:10px; border-radius:8px; cursor:pointer;">CLOSE</button>
                </div>
            </div>

            <div class="perf-iso-margin-container">
                <div class="perf-iso-bar-label-row">
                    <span class="perf-iso-bar-title">SCENARIO COMPARISON</span>
                    <span class="perf-iso-bar-title">LDA: <span id="perf-bar-lda-ft" style="color:white;">--</span> ft / <span id="perf-bar-lda-m" style="color:#06b6d4;">--</span> m</span>
                </div>
                
                <div class="perf-iso-scenario-row">
                    <div class="perf-iso-scenario-header">
                        <span class="perf-iso-sc-title" style="color:#06b6d4">TO 40KT</span>
                        <div class="perf-iso-sc-val-box"><span><span class="perf-iso-val-label">USED:</span><span id="perf-u-40" style="color:white">--</span></span><span><span class="perf-iso-val-label">REM:</span><span id="perf-r-40" style="color:#94a3b8">--</span></span></div>
                    </div>
                    <div class="perf-iso-rwy-strip">
                        <div class="perf-iso-threshold"></div>
                        <div class="perf-iso-marker-td-container" style="left:0%;"><span class="perf-iso-marker-icon">‚úà</span><span class="perf-iso-marker-text">TD</span><div class="perf-iso-marker-line"></div></div>
                        <div id="perf-bar-exit" class="perf-iso-stop-bar" style="background:#06b6d4;"></div>
                    </div>
                </div>

                <div class="perf-iso-scenario-row">
                    <div class="perf-iso-scenario-header">
                        <span class="perf-iso-sc-title" style="color:#22c55e">2000ft TD</span>
                        <div class="perf-iso-sc-val-box"><span><span class="perf-iso-val-label">USED:</span><span id="perf-u-norm" style="color:white">--</span></span><span><span class="perf-iso-val-label">REM:</span><span id="perf-r-norm" style="color:#94a3b8">--</span></span></div>
                    </div>
                    <div class="perf-iso-rwy-strip">
                        <div class="perf-iso-threshold"></div>
                        <div id="perf-mk-norm" class="perf-iso-marker-td-container"><span class="perf-iso-marker-icon">‚úà</span><span class="perf-iso-marker-text">TD</span><div class="perf-iso-marker-line"></div></div>
                        <div id="perf-bar-norm" class="perf-iso-stop-bar" style="background:#22c55e;"></div>
                    </div>
                </div>

                <div class="perf-iso-scenario-row" style="margin-bottom:0">
                    <div class="perf-iso-scenario-header">
                        <span class="perf-iso-sc-title" style="color:#f97316">3000ft TD</span>
                        <div class="perf-iso-sc-val-box"><span><span class="perf-iso-val-label">USED:</span><span id="perf-u-deep" style="color:white">--</span></span><span><span class="perf-iso-val-label">REM:</span><span id="perf-r-deep" style="color:#94a3b8">--</span></span></div>
                    </div>
                    <div class="perf-iso-rwy-strip">
                        <div class="perf-iso-threshold"></div>
                        <div id="perf-mk-deep" class="perf-iso-marker-td-container"><span class="perf-iso-marker-icon">‚úà</span><span class="perf-iso-marker-text" style="color:#f97316; border-color:#f97316">TD</span><div class="perf-iso-marker-line" style="background:#f97316"></div></div>
                        <div id="perf-bar-deep" class="perf-iso-stop-bar" style="background:#f97316;"></div>
                    </div>
                </div>
                
                <div id="perf-rwy-ruler" class="perf-iso-ruler-container"></div>
            </div>
        </div>
    </div>

    <script src="../js/tfc_db2.js"></script>
    <script src="../js/flight_db2.js"></script>
    <script src="../js/v2_script.js"></script>

    <div id="modal-action" class="modal-overlay">
    <div class="modal-card" style="width: 450px;" onclick="event.stopPropagation()">
        <div class="m-head">NEXT ACTION</div>
        
        <div class="action-grid" id="cl-step-select">
            <div class="action-btn btn-ship" onclick="selectCloseAction('SHIP_CHANGE')">
                <div class="icon">‚úàÔ∏è</div>
                <div class="btn-label-main">SHIP CHG</div>
                <div class="btn-label-sub">NEW A/C</div>
            </div>
            <div class="action-btn btn-interval" onclick="selectCloseAction('INTERVAL')">
                <div class="icon">‚è±</div>
                <div class="btn-label-main">INTERVAL</div>
                <div class="btn-label-sub">TRANSIT</div>
            </div>
            <div class="action-btn btn-duty" onclick="selectCloseAction('DUTY_OFF')">
                <div class="icon">üè†</div>
                <div class="btn-label-main">DUTY OFF</div>
                <div class="btn-label-sub">END DAY</div>
            </div>
        </div>

        <div class="cl-container" id="cl-step-list">
            <div style="font-size:0.75rem; font-weight:900; color:var(--primary); margin-bottom:8px;" id="cl-title">CHECKLIST</div>
            <div id="cl-items-area"></div>
            <button id="btn-cl-confirm" class="btn-cl-confirm" onclick="confirmCloseLeg()">CONFIRM COMPLETE</button>
            <button class="btn-cancel" onclick="resetCloseModal()">BACK</button>
        </div>

        <button class="btn-cancel" id="btn-cl-cancel" onclick="closeModal('action')" style="margin-top:15px;">CANCEL</button>
    </div>
</div>

<div class="ending-screen" id="ending-screen" onclick="resetSystem()">
    <div class="plane-container">
        <div class="contrail"></div>
        <svg class="jet-svg" viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>
    </div>
    <div class="end-text-main">See You Again<br>Next Flight.</div>
    <div class="end-text-sub">Duty Completed</div>
    <div class="restart-hint">Tap Screen to Start New Day</div>
</div>

<div id="modal-wb" class="modal-overlay" onclick="closeModal('wb')">
    <div class="wb-card" onclick="event.stopPropagation()">
        <div class="m-head">
            <span>WEIGHT & BALANCE</span>
            <div class="mode-toggle">
                <button class="mode-btn active" id="btn-dom" onclick="setWbMode('DOM')">DOM (22K)</button>
                <button class="mode-btn" id="btn-int" onclick="setWbMode('INT')">INT (27K)</button>
            </div>
            <button class="m-close-small" onclick="closeModal('wb')">√ó</button>
        </div>

        <div class="wb-layout">
            <div class="col-left">
                <div class="sec-label" style="color:#22c55e;">FUEL</div>
                <div class="input-row">
                    <div class="input-group-styled fuel-style" onclick="openWbNumpad('wb-ramp')">
                        <span class="fixed-unit">RAMP (T)</span>
                        <input type="text" id="wb-ramp" class="clean-input" value="--.-" readonly>
                    </div>
                    <div style="flex:1;"></div>
                </div>

                <div class="sec-label" style="color:#94a3b8;">TAKEOFF (TO)</div>
                <div class="input-row">
                    <div class="input-group-styled" onclick="openWbNumpad('wb-gw')">
                        <span class="fixed-unit">ATXW (T)</span>
                        <input type="text" id="wb-gw" class="clean-input" value="---.-" readonly>
                    </div>
                    <div class="input-group-styled" onclick="openWbNumpad('wb-cg')">
                        <span class="fixed-unit">CG%</span>
                        <input type="text" id="wb-cg" class="clean-input" value="--.-" readonly>
                    </div>
                </div>

                <div class="sec-label" style="color:#f59e0b;">LANDING (LDG)</div>
                <div class="input-row">
                    <div class="input-group-styled ldg-style" onclick="openWbNumpad('wb-gw-ldg')">
                        <span class="fixed-unit" style="color:#f59e0b;">GW (T)</span>
                        <input type="text" id="wb-gw-ldg" class="clean-input" value="---.-" readonly>
                    </div>
                    <div class="input-group-styled ldg-style" onclick="openWbNumpad('wb-cg-ldg')">
                        <span class="fixed-unit" style="color:#f59e0b;">CG%</span>
                        <input type="text" id="wb-cg-ldg" class="clean-input" value="--.-" readonly>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="cg-chart" width="420" height="240"></canvas>
                    <div class="thrust-badge" id="thrust-badge">THRUST: 22K</div>
                </div>
            </div>

            <div class="col-right">
                <div class="limit-card active-card" id="card-to">
                    <div class="lc-title">MAX TAKEOFF WEIGHT</div>
                    <div class="lc-row">
                        <span class="lc-label">MTOW</span>
                        <span class="lc-val" id="limit-to">149.9</span>
                    </div>
                    <div class="lc-row">
                        <span class="lc-label">ATXW</span>
                        <span class="lc-val" id="disp-gw-to">145.5</span>
                    </div>
                    <div class="lc-bar-bg"><div class="lc-bar-fill" id="bar-to" style="width: 0%;"></div></div>
                    <div class="lc-margin-row">
                        <span>MARGIN</span>
                        <span id="margin-to">--</span>
                    </div>
                    
                    <div id="burn-alert" class="burn-alert">
                        <div style="font-size:0.7rem; opacity:0.8;">MIN BURN</div>
                        <div id="burn-val">0.0 T</div>
                        <div style="border-top:1px solid rgba(239,68,68,0.3); margin:5px 0;"></div>
                        <div style="font-size:0.7rem; opacity:0.8; color:#f59e0b;">TARGET TOF</div>
                        <span id="tof-val" class="tof-highlight">--</span>
                    </div>
                </div>

                <div class="limit-card active-card" id="card-ldg" style="border-color: rgba(245, 158, 11, 0.3);">
                    <div class="lc-title" style="color:#f59e0b;">MAX LANDING WEIGHT</div>
                    <div class="lc-row">
                        <span class="lc-label">MLDW</span>
                        <span class="lc-val" id="limit-ldg">144.0</span>
                    </div>
                    <div class="lc-row">
                        <span class="lc-label">ACTUAL</span>
                        <span class="lc-val" id="disp-gw-ldg">---.-</span>
                    </div>
                    <div class="lc-bar-bg"><div class="lc-bar-fill" id="bar-ldg" style="width: 0%; background:#f59e0b;"></div></div>
                    <div class="lc-margin-row">
                        <span>MARGIN</span>
                        <span id="margin-ldg">--</span>
                    </div>
                </div>

                <div class="limit-card active-card" id="card-zfw">
                     <div class="lc-title" style="color:#94a3b8;">MAX ZERO FUEL</div>
                     <div class="lc-row">
                        <span class="lc-label">LIMIT</span>
                        <span class="lc-val" id="limit-zfw">136.0</span>
                     </div>
                </div>

                <div id="cg-status-box">WITHIN LIMITS</div>
            </div>
        </div>
        
        <button class="btn-close" style="margin-top:15px;" onclick="closeModal('wb')">CLOSE</button>
    </div>
</div>

<div id="modal-wb-numpad" class="modal-overlay" onclick="closeWbNumpad()">
    <div class="numpad-card" onclick="event.stopPropagation()">
        <div class="np-header">
            <span id="wb-np-label">INPUT VALUE</span>
            <span id="wb-np-val"></span>
        </div>
        <div class="np-grid">
            <button onclick="wbNpInput('7')">7</button><button onclick="wbNpInput('8')">8</button><button onclick="wbNpInput('9')">9</button>
            <button onclick="wbNpInput('4')">4</button><button onclick="wbNpInput('5')">5</button><button onclick="wbNpInput('6')">6</button>
            <button onclick="wbNpInput('1')">1</button><button onclick="wbNpInput('2')">2</button><button onclick="wbNpInput('3')">3</button>
            
            <button onclick="wbNpInput('.')" style="font-size:1.5rem; padding-bottom:10px;">.</button>
            <button onclick="wbNpInput('0')">0</button>
            <button onclick="wbNpClear()" class="del" style="color:#f59e0b !important;">C</button>
            
            <button onclick="wbNpBack()" class="del">‚å´</button>
            <button onclick="wbNpConfirm()" class="np-ok" style="grid-column: span 2;">ENTER</button>
        </div>
    </div>
</div>

<div id="modal-hold" class="modal-overlay" onclick="closeModal('hold')">
    <div class="modal-card" style="padding:0; overflow:hidden;" onclick="event.stopPropagation()">
        
        <div class="hold-header">
            <div class="hold-title">HOLDING REFERENCE</div>
            <div class="hold-subtitle">JAPAN SPECIFIC RULES</div>
            <button class="m-close-small" style="position:absolute; right:15px; top:15px;" onclick="closeModal('hold')">√ó</button>
        </div>

        <div class="hold-tabs">
            <button id="tab-hold-st" class="hold-tab active" onclick="holdUpdate('station')">NAV STATION</button>
            <button id="tab-hold-dme" class="hold-tab" onclick="holdUpdate('dme')">DME DISTANCE</button>
        </div>

        <div style="overflow-y:auto; flex:1;">
            
            <div class="hold-section">
                <span class="hold-sec-title">MAXIMUM SPEED (IAS)</span>
                <div class="hold-spd-row" style="border-left-color: var(--green);">
                    <span class="hold-spd-alt">MHA - 6,000ft</span>
                    <span id="hold-v1" class="hold-spd-val">210 KT</span>
                </div>
                <div class="hold-spd-row" style="border-left-color: var(--cyan);">
                    <span class="hold-spd-alt">6,001 - 14,000ft</span>
                    <span id="hold-v2" class="hold-spd-val">220 KT</span>
                </div>
                <div class="hold-spd-row" style="border-left-color: var(--purple);">
                    <span class="hold-spd-alt">ABOVE 14,000ft</span>
                    <span id="hold-v3" class="hold-spd-val">240 KT</span>
                </div>
            </div>

            <div class="hold-section">
                <div class="hold-grid-2">
                    <div id="view-hold-st" class="hold-grid-2" style="grid-column: span 2;">
                        <div class="hold-info-box">
                            <span class="hold-info-label">TIME (‚â§14000)</span>
                            <span class="hold-info-val" style="color:var(--green)">1.0 MIN</span>
                        </div>
                        <div class="hold-info-box">
                            <span class="hold-info-label">TIME (>14000)</span>
                            <span class="hold-info-val" style="color:var(--green)">1.5 MIN</span>
                        </div>
                    </div>

                    <div id="view-hold-dme" class="hold-calc-container hidden">
                        <span class="hold-sec-title" style="color: var(--cyan); margin-bottom: 8px;">DME LEG CALCULATOR</span>
                        <div class="hold-calc-row">
                            <div class="hold-calc-group">
                                <label>INBD FIX</label>
                                <input type="number" id="in-dme" placeholder="0.0" step="0.1" oninput="holdCalcLeg()">
                            </div>
                            <div class="hold-calc-group">
                                <label>OUTBD FIX</label>
                                <input type="number" id="out-dme" placeholder="0.0" step="0.1" oninput="holdCalcLeg()">
                            </div>
                        </div>
                        <div class="hold-res-display">
                            <span id="res-hold-dist" class="hold-res-val">0.0 NM</span>
                            <button class="hold-reset-btn" onclick="holdResetCalc()">Reset</button>
                        </div>
                    </div>

                    <div class="hold-info-box hold-turb-box">
                        <span class="hold-info-label" style="color: var(--amber);">TURBULENT SPEED LIMIT</span>
                        <span class="hold-info-val hold-turb-val">280 KT / M 0.8</span>
                        <span style="font-size: 0.5rem; color: var(--muted);">(Lesser of)</span>
                    </div>
                    <div class="hold-info-box" style="grid-column: span 2;">
                        <span class="hold-info-label">BANK ANGLE (LESSER OF)</span>
                        <span class="hold-info-val">25¬∞ / 3¬∞ SEC</span>
                    </div>
                </div>
            </div>

            <div class="hold-section" style="border:none; background: rgba(15, 23, 42, 0.8);">
                <span class="hold-sec-title">GENERAL RULES</span>
                <ul class="hold-rule-list">
                    <li class="hold-rule-item">ÊåáÁ§∫„Åå„Å™„ÅÑÂ†¥Âêà„ÅØR-TURN</li>
                    <li class="hold-rule-item">HOLDINGÊåáÁ§∫„ÅßÈÄüÂ∫¶Ë™øÊï¥CANCEL(Ê∏õÈÄüÂèØ)</li>
                    <li class="hold-rule-item">FIX 5ÂàÜÂâç„Åæ„Åß„Å´CLRÁô∫Âá∫ / 3ÂàÜÂâç„Åæ„Åß„Å´Ê∏õÈÄüÂÆå‰∫Ü</li>
                </ul>
                <div class="hold-rule-important">
                    <span>‚ö†Ô∏è</span> EXIT„ÅÆÈöõ MEAÊ≥®ÊÑè
                </div>
            </div>

        </div>
        <button class="m-close" onclick="closeModal('hold')" style="border-radius:0; margin:0;">CLOSE</button>
    </div>
</div>

<div id="modal-converter" class="modal-overlay" onclick="closeModal('converter')">
    <div class="modal-card" style="width: 500px;" onclick="event.stopPropagation()">
        <div class="m-head">SPD / MACH CONVERTER</div>

        <div class="conv-container">
           <div class="conv-section">
    <span class="conv-label">ALTITUDE (FL)</span>
    <div class="conv-input-row">
        <button class="conv-step-btn" onclick="adjConvAlt(-10)">-10</button>
        <div class="input-group-styled" style="flex:1" onclick="openConvNumpad('conv-alt')">
    <span class="fixed-unit" style="margin-right:5px; margin-left:0; color:var(--primary);">FL</span>
    
    <input type="text" id="conv-alt" class="clean-input" value="240" readonly>
</div>
        <button class="conv-step-btn" onclick="adjConvAlt(10)">+10</button>
    </div>
    
    <div class="conv-sub-info">
        <span>SAT: <span id="conv-sat" style="color:var(--cyan)">--</span>¬∞C</span>
        <span>SOUND: <span id="conv-sound" style="color:var(--muted)">--</span> KT</span>
    </div>
    </div>
            <div class="conv-divider"></div>

            <div class="conv-grid">
                <div class="conv-col">
                    <span class="conv-label">CAS (IAS)</span>
                    <div class="input-group-styled conv-active-input" onclick="openConvNumpad('conv-ias')">
    <input type="text" id="conv-ias" class="clean-input" value="280" style="color:var(--green)" readonly>
    <span class="fixed-unit">KT</span>
</div>
                </div>

                <div class="conv-arrow">‚áÑ</div>

                <div class="conv-col">
                    <span class="conv-label">MACH</span>
                    <div class="input-group-styled conv-active-input" onclick="openConvNumpad('conv-mach')">
    <span style="font-weight:900; color:var(--cyan); margin-right:2px;">M</span>
    <input type="text" id="conv-mach" class="clean-input" value="0.78" style="color:var(--cyan)" readonly>
</div>
                </div>
            </div>

            <div class="conv-result-box">
                <span class="conv-res-label">TRUE AIRSPEED</span>
                <div class="conv-res-val"><span id="conv-tas">---</span> <span style="font-size:1rem; color:#94a3b8;">KT</span></div>
            </div>
        </div>

        <button class="m-close" onclick="closeModal('converter')">CLOSE</button>
    </div>
</div>

<div id="modal-conv-numpad" class="modal-overlay" onclick="closeConvNumpad()">
    <div class="numpad-card" onclick="event.stopPropagation()">
        <div class="np-header">
            <span id="conv-np-label">INPUT VALUE</span>
            <span id="conv-np-val"></span>
        </div>
        <div class="np-grid">
            <button onclick="convNpInput('7')">7</button><button onclick="convNpInput('8')">8</button><button onclick="convNpInput('9')">9</button>
            <button onclick="convNpInput('4')">4</button><button onclick="convNpInput('5')">5</button><button onclick="convNpInput('6')">6</button>
            <button onclick="convNpInput('1')">1</button><button onclick="convNpInput('2')">2</button><button onclick="convNpInput('3')">3</button>
            
            <button onclick="convNpInput('.')">.</button>
            <button onclick="convNpInput('0')">0</button>
            <button onclick="convNpClear()" class="del" style="color:#f59e0b !important;">C</button>
            
            <button onclick="convNpBack()" class="del">‚å´</button>
            <button onclick="convNpConfirm()" class="np-ok" style="grid-column: span 2;">ENTER</button>
        </div>
    </div>
</div>



<div id="modal-scenario" class="modal-overlay" onclick="closeModal('scenario')">
    <div class="modal-card" style="width: 700px;" onclick="event.stopPropagation()">
        <div class="m-head">
            SCENARIO ANALYZER
            <div style="font-size:0.7rem; color:#64748b; font-weight:400; align-self:center;">COST/MIN CALCULATOR</div>
        </div>
        
        <div class="sa-container">
            <div class="sa-header-row">
    <div class="sa-input-group" onclick="saOpenNumpad('sa-dist', 'DISTANCE (NM)')">
        <span class="sa-label">REM DIST (NM)</span>
        <input type="text" id="sa-dist" class="clean-input" value="400" readonly>
    </div>
    <div class="sa-input-group" onclick="saOpenNumpad('sa-wt', 'WEIGHT (1000 LBS)')">
        <span class="sa-label">WEIGHT (1000 LBS)</span>
        <input type="text" id="sa-wt" class="clean-input" value="135" readonly>
    </div>
</div>

            <div class="sa-grid-compare">
                <div class="sa-panel base">
                    <div class="sa-panel-head">FPL (PLAN)</div>
                    
                    <div class="sa-input-row">
                        <span class="sa-row-label">FL</span>
                        <select id="sa-base-fl" class="clean-select" onchange="calcScenario()">
                        </select>
                    </div>

                    <div class="sa-input-row" onclick="saOpenNumpad('sa-base-mach', 'FPL MACH')">
                        <span class="sa-row-label">MACH</span>
                        <input type="text" id="sa-base-mach" class="clean-input" value="0.78" readonly>
                    </div>

                    <div class="sa-input-row" onclick="saOpenNumpad('sa-base-wind', 'FPL WIND (+Tail/-Head)')">
                        <span class="sa-row-label">WIND</span>
                        <input type="text" id="sa-base-wind" class="clean-input" value="0" readonly>
                        <span class="sa-unit">KT</span>
                    </div>

                    <div class="sa-info-disp">
                        TAS: <span id="sa-base-tas">---</span> KT / GS: <span id="sa-base-gs">---</span> KT<br>
                        <span class="sa-temp-val">SAT: <span id="sa-base-temp">--</span>¬∞C</span>
                        <span class="sa-conv-val" id="sa-base-conv">IAS: --- KT</span>
                    </div>
                </div>

                <div class="sa-arrow">‚ñ∂</div>

                <div class="sa-panel scenario">
                    <div class="sa-panel-head">SCENARIO (ACTUAL)</div>
                    
                    <div class="sa-input-row">
                        <span class="sa-row-label">FL</span>
                        <select id="sa-tgt-fl" class="clean-select" onchange="calcScenario()">
                        </select>
                    </div>

                    <div class="sa-input-row" onclick="openScenarioSpdNumpad()">
    <div style="display:flex; flex-direction:column; gap:2px;">
        <span class="sa-row-label">SPD</span>
        <div class="mode-toggle-group">
            <button id="btn-mode-mach" class="mode-btn active" onclick="setSaMode('mach', event)">MACH</button>
            <button id="btn-mode-ias" class="mode-btn" onclick="setSaMode('ias', event)">IAS</button>
        </div>
    </div>
    <input type="text" id="sa-tgt-val" class="clean-input" value="0.78" readonly>
</div>

                    <div class="sa-input-row" onclick="saOpenNumpad('sa-tgt-wind', 'SCENARIO WIND')">
                        <span class="sa-row-label">WIND</span>
                        <input type="text" id="sa-tgt-wind" class="clean-input" value="0" readonly>
                        <span class="sa-unit">KT</span>
                    </div>

                    <div class="sa-info-disp">
                        TAS: <span id="sa-tgt-tas">---</span> KT / GS: <span id="sa-tgt-gs">---</span> KT<br>
                        <span class="sa-temp-val">SAT: <span id="sa-tgt-temp">--</span>¬∞C</span>
                        <span class="sa-conv-val" id="sa-tgt-conv">IAS: --- KT</span>
                    </div>
                </div>
            </div>

            <div class="sa-result-area">
                <div class="sa-res-box">
                    <div class="sa-res-title">TIME DIFF</div>
                    <div class="sa-res-val" id="sa-res-time">--:--</div>
                    <div class="sa-res-sub" id="sa-time-sub">TOTAL --:--</div>
                </div>
                <div class="sa-res-box">
                    <div class="sa-res-title">BOF DIFF (ACTUAL)</div>
                    <div class="sa-res-val" id="sa-res-fuel">-- LBS</div>
                    <div class="sa-res-sub" id="sa-res-fuel-pct">(--%)</div>
                </div>
            </div>

            <div class="sa-judge" id="sa-judge-text">INPUT DATA</div>
        </div>
        <button class="m-close" onclick="closeModal('scenario')">CLOSE</button>
    </div>
</div>

<div id="modal-sa-numpad" class="modal-overlay" onclick="saCloseNumpad()">
    <div class="numpad-card" onclick="event.stopPropagation()">
        <div class="np-header">
            <span id="sa-np-label">INPUT VALUE</span>
            <span id="sa-np-val"></span>
        </div>
        <div class="np-grid">
            <button onclick="saNpInput('7')">7</button><button onclick="saNpInput('8')">8</button><button onclick="saNpInput('9')">9</button>
            <button onclick="saNpInput('4')">4</button><button onclick="saNpInput('5')">5</button><button onclick="saNpInput('6')">6</button>
            <button onclick="saNpInput('1')">1</button><button onclick="saNpInput('2')">2</button><button onclick="saNpInput('3')">3</button>
            <button onclick="saNpInput('.')">.</button><button onclick="saNpInput('0')">0</button>
            <button onclick="saNpClear()" class="del" style="color:#f59e0b !important;">C</button>
            <button onclick="saNpBack()" class="del">‚å´</button>
            <button onclick="saNpConfirm()" class="np-ok" style="grid-column: span 2;">ENTER</button>
        </div>
    </div>
</div>

<div id="modal-log" class="modal-overlay" onclick="closeModal('log')">
    <div class="modal-card" style="width: 700px !important; max-width: 95vw; max-height: 95vh; display: flex; flex-direction: column; overflow: hidden;" onclick="event.stopPropagation()">
        
        <div class="m-head">
            PERSONAL LOG
            <div style="font-size:0.7rem; color:#94a3b8; font-weight:400;">JCAB FORMAT</div>
        </div>
        
        <div class="log-layout">
            <div class="log-info-row">
                <div class="log-info-col">
                    <span class="log-label-mini">DATE / FLT / SHIP</span>
                    <div style="display:flex; gap:10px; align-items:baseline;">
                        <span id="log-date" class="log-info-text" style="color:var(--primary);">--/--</span>
                        <span id="log-flt" class="log-info-text">JL----</span>
                        <span id="log-ship" class="log-info-text" style="color:var(--accent); cursor:pointer; text-decoration:underline;" onclick="openShipInput()">JA----J</span>
                    </div>
                </div>
                <div class="log-info-col" style="align-items:center;">
                    <span class="log-label-mini">ROUTE</span>
                    <div style="display:flex; gap:5px; align-items:center;">
                        <input type="text" id="log-dep" class="route-input" placeholder="DEP" readonly>
                        <span style="color:#94a3b8;">‚ñ∏</span>
                        <input type="text" id="log-arr" class="route-input" placeholder="ARR" readonly>
                    </div>
                </div>
                <div class="log-info-col" style="width:100px;">
                    <span class="log-label-mini">ROLE</span>
                    <div class="toggle-row">
                        <button class="toggle-btn active" id="btn-role-co" onclick="setLogRole('CO')">CO</button>
                        <button class="toggle-btn" id="btn-role-pus" onclick="setLogRole('PUS')">PUS</button>
                    </div>
                </div>
            </div>

            <div class="log-section-title">BLOCK TIMES</div>
            <div class="log-grid-row">
                <div class="log-box" onclick="openLogNumpad('log-t-out', 'OUT TIME', 'time')">
                    <span class="log-label">OUT (UTC)</span>
                    <input type="text" id="log-t-out" class="log-input-lg" placeholder="--:--" readonly>
                    <button class="log-set-btn" onclick="event.stopPropagation(); setLogTime('out')">SET NOW</button>
                </div>
                <div class="log-box" onclick="openLogNumpad('log-t-in', 'IN TIME', 'time')">
                    <span class="log-label">IN (UTC)</span>
                    <input type="text" id="log-t-in" class="log-input-lg" placeholder="--:--" readonly>
                    <button class="log-set-btn" onclick="event.stopPropagation(); setLogTime('in')">SET NOW</button>
                </div>
            </div>

            <div class="log-result-bar">
                <span style="font-size:0.8rem; font-weight:700; color:#94a3b8;">TOTAL BLOCK TIME</span>
                <span id="log-res-blk" class="log-res-val">00:00</span>
            </div>

            <div class="log-section-title">OPERATIONAL DETAILS</div>
            <div class="log-grid-row">
                <div class="log-assign-box">
                    <div class="assign-header">TAKEOFF</div>
                    <div class="toggle-row">
                        <button class="toggle-btn active" id="btn-to-pf" onclick="setAssign('to', 'pf')">PF</button>
                        <button class="toggle-btn" id="btn-to-pm" onclick="setAssign('to', 'pm')">PM</button>
                    </div>
                    <div class="toggle-row" style="margin-top:5px;">
                        <button class="toggle-btn active-day" id="btn-to-day" onclick="setCond('to', 'day')">DAY</button>
                        <button class="toggle-btn" id="btn-to-ngt" onclick="setCond('to', 'ngt')">NGT</button>
                    </div>
                </div>
                <div class="log-assign-box">
                    <div class="assign-header">LANDING</div>
                    <div class="toggle-row">
                        <button class="toggle-btn active" id="btn-ldg-pf" onclick="setAssign('ldg', 'pf')">PF</button>
                        <button class="toggle-btn" id="btn-ldg-pm" onclick="setAssign('ldg', 'pm')">PM</button>
                    </div>
                    <div class="toggle-row" style="margin-top:5px;">
                        <button class="toggle-btn active-day" id="btn-ldg-day" onclick="setCond('ldg', 'day')">DAY</button>
                        <button class="toggle-btn" id="btn-ldg-ngt" onclick="setCond('ldg', 'ngt')">NGT</button>
                    </div>
                </div>
            </div>

            <div class="log-grid-row">
                <div class="input-styled" onclick="openLogNumpad('log-t-ngt', 'NIGHT TIME', 'duration')">
                    <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                        <span class="log-label">NGT TIME</span>
                        <button class="mini-btn" onclick="event.stopPropagation(); setNgtToBlock()">ALL</button>
                    </div>
                    <input type="text" id="log-t-ngt" class="clean-input" placeholder="00h00m" readonly>
                </div>
                <div class="input-styled" onclick="openLogNumpad('log-t-inst', 'INST TIME', 'duration')">
                    <span class="log-label">INST TIME</span>
                    <input type="text" id="log-t-inst" class="clean-input" placeholder="00h00m" readonly>
                </div>
            </div>
            
            <textarea id="log-memo" class="log-memo-area" placeholder="Remarks..." oninput="updateLogMemo(this.value)"></textarea>

            <div class="logbook-preview">
                <div id="log-preview-header" class="preview-text" style="color:var(--muted); border-bottom:1px solid #334155; padding-bottom:5px; margin-bottom:5px; opacity:0.7;"></div>
                <div id="log-preview-text" class="preview-text" style="font-weight:700; color:var(--text);">Loading...</div>
                
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="copy-btn-lg" onclick="copyLogbookFormat()" style="flex: 1; margin-top: 0;">
                        <span>üìã COPY ROW</span>
                    </button>
                    <button class="copy-btn-lg" onclick="downloadHistoryCsv()" style="flex: 1; margin-top: 0; background: var(--success); color: #020617;">
                        <span>üíæ CSV EXPORT</span>
                    </button>
                </div>

                <button class="copy-btn-lg" onclick="openHistoryManager()" style="width: 100%; margin-top: 10px; background: #475569; color: white;">
                    <span>üìñ MANAGE HISTORY (EDIT/DEL)</span>
                </button>
            </div>
        </div>
        
        <button class="m-close" onclick="closeModal('log')">CLOSE</button>
    </div>
</div>

<div id="modal-log-numpad" class="modal-overlay" onclick="closeLogNumpad()">
    <div class="numpad-card" onclick="event.stopPropagation()">
        <div class="np-header">
            <span id="log-np-label">INPUT</span>
            <span id="log-np-val"></span>
        </div>
        <div class="np-grid">
            <button class="np-btn" onclick="logNpInput('7')">7</button><button class="np-btn" onclick="logNpInput('8')">8</button><button class="np-btn" onclick="logNpInput('9')">9</button>
            <button class="np-btn" onclick="logNpInput('4')">4</button><button class="np-btn" onclick="logNpInput('5')">5</button><button class="np-btn" onclick="logNpInput('6')">6</button>
            <button class="np-btn" onclick="logNpInput('1')">1</button><button class="np-btn" onclick="logNpInput('2')">2</button><button class="np-btn" onclick="logNpInput('3')">3</button>
            <button class="np-btn" onclick="logNpInput('.')">.</button><button class="np-btn" onclick="logNpInput('0')">0</button>
            <button class="np-btn del" onclick="logNpBack()">‚å´</button>
            <button class="np-btn cancel" onclick="logNpClear()">CLR</button>
            <button class="np-btn confirm" onclick="logNpConfirm()">ENTER</button>
        </div>
    </div>
</div>

<div id="modal-history" class="modal-overlay" onclick="closeModal('history')">
    <div class="modal-card" style="width: 700px; height: 90vh; display: flex; flex-direction: column;" onclick="event.stopPropagation()">
        <div class="m-head">HISTORY MANAGER</div>
        
        <div id="hist-list-view" style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px 0;">
            </div>

        <div id="hist-editor-view" style="display: none; flex: 1; overflow-y: auto; flex-direction: column; gap: 10px;">
            <div class="log-info-row" style="background:rgba(255,255,255,0.05);">
                <span class="log-label-mini">EDITING RECORD</span>
                <input type="hidden" id="hist-edit-idx">
            </div>
            
            <div class="log-grid-row">
                <div class="input-styled"><span class="log-label">DATE</span><input type="text" id="he-date" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">FLT</span><input type="text" id="he-flt" class="clean-input"></div>
            </div>
            <div class="log-grid-row">
                <div class="input-styled"><span class="log-label">SHIP</span><input type="text" id="he-ship" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">DEP</span><input type="text" id="he-dep" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">ARR</span><input type="text" id="he-arr" class="clean-input"></div>
            </div>
            <div class="log-grid-row">
                <div class="input-styled"><span class="log-label">OUT</span><input type="text" id="he-out" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">IN</span><input type="text" id="he-in" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">BLK TIME</span><input type="text" id="he-blk" class="clean-input"></div>
            </div>
            
            <div class="log-section-title">TIMES & ROLES</div>
            <div class="log-grid-row">
                <div class="input-styled"><span class="log-label">PIC</span><input type="text" id="he-pic" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">PIC X/C</span><input type="text" id="he-picxc" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">PIC NGT</span><input type="text" id="he-picngt" class="clean-input"></div>
            </div>
            <div class="log-grid-row">
                <div class="input-styled"><span class="log-label">CO</span><input type="text" id="he-co" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">CO X/C</span><input type="text" id="he-coxc" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">CO NGT</span><input type="text" id="he-congt" class="clean-input"></div>
            </div>
            <div class="log-grid-row">
                <div class="input-styled"><span class="log-label">INST</span><input type="text" id="he-inst" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">T/O</span><input type="text" id="he-to" class="clean-input"></div>
                <div class="input-styled"><span class="log-label">LDG</span><input type="text" id="he-ldg" class="clean-input"></div>
            </div>
            <div class="input-styled">
                <span class="log-label">REMARKS</span>
                <input type="text" id="he-memo" class="clean-input" style="text-align:left;">
            </div>

            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="copy-btn-lg" onclick="cancelHistoryEdit()" style="background:#475569;">CANCEL</button>
                <button class="copy-btn-lg" onclick="saveHistoryEdit()" style="background:var(--success); color:#020617;">SAVE CHANGES</button>
            </div>
        </div>

        <button class="m-close" onclick="closeModal('history')">CLOSE</button>
    </div>
</div>

<div id="modal-export" class="modal-overlay" onclick="closeModal('export')">
    <div class="modal-card" style="width: 400px; height: auto;" onclick="event.stopPropagation()">
        <div class="m-head">CSV EXPORT SETTINGS</div>
        
        <div style="padding: 20px 0; display:flex; flex-direction:column; gap:15px;">
            <div class="input-styled">
                <span class="log-label">FROM</span>
                <input type="date" id="exp-from" class="clean-input" style="text-align:left; font-family:'Inter'; font-size:1rem;">
            </div>
            
            <div class="input-styled">
                <span class="log-label">TO</span>
                <input type="date" id="exp-to" class="clean-input" style="text-align:left; font-family:'Inter'; font-size:1rem;">
            </div>
        </div>

        <button class="copy-btn-lg" onclick="executeExport()" style="background: var(--success); color:#020617; margin-bottom:10px;">
            <span>üíæ DOWNLOAD CSV</span>
        </button>
        
        <button class="m-close" onclick="closeModal('export')">CANCEL</button>
    </div>
</div>

<div id="modal-wind-numpad" class="modal-overlay" onclick="closeWindNumpad()">
    <div class="numpad-card" onclick="event.stopPropagation()">
        <div class="np-header">
            <span id="wind-np-label">INPUT</span>
            <span id="wind-np-val"></span>
        </div>
        <div class="np-grid">
            <button onclick="windNpInput('7')">7</button><button onclick="windNpInput('8')">8</button><button onclick="windNpInput('9')">9</button>
            <button onclick="windNpInput('4')">4</button><button onclick="windNpInput('5')">5</button><button onclick="windNpInput('6')">6</button>
            <button onclick="windNpInput('1')">1</button><button onclick="windNpInput('2')">2</button><button onclick="windNpInput('3')">3</button>
            <button onclick="windNpInput('0')" class="zero">0</button>
            <button onclick="windNpClear()" class="del" style="color:#f59e0b !important;">C</button>
            <button onclick="windNpBack()" class="del">‚å´</button>
            <button onclick="windNpConfirm()" class="np-ok" style="grid-column: span 2;">ENTER</button>
        </div>
    </div>
</div>

</body>
</html>
